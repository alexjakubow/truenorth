---
title: "OSF Preprint Assertions"
date: "2025-08-12"
date-modified: last-modified
---

# Overview

This method measures lifecycle open science on OSF by looking at preprint assertions linked to open science preprints.  

## Definitions

> **Open Science Preprint (OSP)**: An OSF Preprint that is jointly *open*, *non-deprecated*, and *authentic*

- Openness Criteria:
    1. Public (open-1)

- Non-Deprecation Criteria:
    1. Accepted (nondeprecated-1)
    2. Published (nondeprecated-2)
    3. Not Deleted (nondeprecated-3)
    4. Not Withdrawn (nondeprecated-4)

- Authenticity Criteria:
    1. Not Spam (authentic-1)

>  **LOS-Preprint**: An OSP that represents a lifecycle open science research project.

- Lifecycle Open Criteria:

    1. **Plan**: The OSP has at least 1 linked preregistration
    2. **Output**: The OSP has at least 1 linked dataset


# Results

```{r}
# Packages
library(arrow)
library(ggplot2)
library(ggiraph)
library(glue)
library(gt)
library(dplyr)
library(lubridate)
library(plotly)
library(scales)
library(tidyr)
library(timetk)

# Modules
box::use(
  R / plot[pivoter, ppt_factorizer, ts_prep],
  R / parameters[DATES, OUTPUTS, PLANS]
)



# Local functions
table_helper <- function(tbl, title  = "Lifecycle Open Science Preprints", interactive = TRUE, ...) {
    gtbl <- tbl |>
        gt() |>
        tab_header(title = title,
        subtitle = paste0("as of ", MOST_RECENT_CHR)
    ) |>
    fmt_number(columns = c(OSP:`LOS-Preprint`), decimals = 0) |>
    fmt_percent(columns = `LOS-Preprint / OSP`, decimals = 2) |>
    tab_footnote(
        footnote = md("*OSP: Open Science Preprint*"),
        locations = cells_column_labels(columns = OSP)
    ) |>
    tab_footnote(
        footnote = md("*LOS-Preprint: Lifecycle Open Science Preprint*"),
        locations = cells_column_labels(columns = `LOS-Preprint`)
    ) |>
    opt_footnote_marks("letters") |>
    opt_row_striping(row_striping = TRUE) 

    if (interactive) {
        gtbl |>
            opt_interactive(...) |>
            opt_horizontal_padding(0)
    } else {
        gtbl
    }
}


tte_table <- function(tbl, title = "Time to Lifecycle Open Status (in days)", group_label = NULL, ...) {
  # Set title
  TITLE <- "Time to Lifecycle Open Status (in days)"
  if (!is.null(group_label)) {
    TITLE <- paste0(TITLE, " by ", stringr::str_to_title(group_label))
  }

  # Subset data
  tbl <- tbl |>
    select(..., event, n, p, mean, p50, sd, min, max) |>
    filter(tolower(event) %in% c("output", "outcome", "lifecycle")) |>
    mutate(
      event = stringr::str_to_title(event),
      event = factor(event, levels = c("Output", "Outcome", "Lifecycle"))
    ) |>
    arrange(event) |>
    mutate(event = as.character(event))

  # Format table
  gtbl <- tbl |>
    gt(row_group_as_column = TRUE) |>
    tab_header(
      title = TITLE,
      subtitle = "Among all Open Science Preprints (OSP) with 1+ linked resource") |>
    cols_label(
      event = "Event",
      n = "Count",
      p = "Percent",
      mean = "Mean",
      p50 = "Median",
      sd = "Std. Dev.",
      min = "Min",
      max = "Max"
    ) |>
    #Spanners
    tab_spanner(columns = c(n, p), label = "Prevalance") |>
    tab_spanner(columns = c(mean, p50, sd, min, max), label = "Distribution") |>
    # Value formatting
    fmt_number(columns = c(n, mean, p50, sd, min, max), decimals = 0) |>
    fmt_percent(columns = p, decimals = 1)
  # Return table
  gtbl
}


# Data sources
all_ts <- read_parquet(here::here("data/preprint_tsmonthly.parquet"))
provider_ts <- read_parquet(here::here("data/preprint_providers_tsmonthly.parquet"))

# Pivot for plots and assign labels
all_summary <- pivoter(all_ts) |>
    ts_prep()
provider_summary <- pivoter(provider_ts, provider) |>
    ts_prep()

# Constants
MOST_RECENT_CHR <- max(all_ts$date)
MOST_RECENT <- ymd(MOST_RECENT_CHR)
TABLE_CRITERIA <- c(
    "los_outcome", "los_plans", "los_outputs", "los_complete")
TABLE_NAMES <- c(
    "OSP", "OSP + Plan(s)", "OSP + Output(s)", "LOS-Preprint"
)
```

## Today
Here is the current state of LOS research projects on the OSF as of `r max(all_ts$date)`.  For all of the summary tables below, the following fields are included:

- `<GROUP_NAME>`: An optional grouping variable for seeing disaggregated results (e.g., by provider, institutional membership, etc.)
- `OSP`: Number of Open Science Preprints (i.e., Open + Non-deprecated + Authentic)
- `OSP + Plan`: Number of Open Science Preprints with at least one linked output resource
- `OSP + Outcome(s)`: Number of Open Science Preprints with at least one linked outcome resource
- `LOS-Preprint`: Lifecycle Open Science Preprints - number of Open Science Preprints with at least one linked outcome and at least one linked output resource
- `LOS-Preprint / OSP`: Percentage of Open Science OSF Preprints (OSP) that are Lifecycle Open Science Preprints (LOS-Preprint)


### Aggregate

```{r}
overall_tbl <- all_summary |>
    filter(criteria %in% TABLE_CRITERIA) |>
    pivot_wider(names_from = criteria, values_from = n) 
names(overall_tbl) <-c("Date", TABLE_NAMES)

overall_tbl <- overall_tbl |>
    mutate(
        `LOS-Preprint / OSP` = `LOS-Preprint` / `OSP`,
    )

today_gtbl <- overall_tbl |>
    filter(Date == MOST_RECENT) |>
    select(-Date) |>
    table_helper("Lifecycle Open Science Preprints", use_pagination = FALSE, use_sorting = FALSE)

today_gtbl
```

### By Provider

```{r}
provider_tbl <- provider_summary |>
    filter(criteria %in% TABLE_CRITERIA) |>
    pivot_wider(names_from = criteria, values_from = n) 
names(provider_tbl) <-c("Date", "Provider", TABLE_NAMES)

provider_tbl <- provider_tbl |>
    mutate(
        `LOS-Preprint / OSP` = `LOS-Preprint` / `OSP`,
    )

today_provider_tbl <- provider_tbl |> 
    ungroup() |>
    filter(Date == MOST_RECENT) |>
    arrange(desc(`LOS-Preprint`)) |>
    select(-Date) |>    
    table_helper("Lifecycle Open Science Preprints by Provider", use_pagination = FALSE)

today_provider_tbl
```


## Time to Lifecycle Open Science


```{r}
# TODO: Compute date of OSP status from logged event tables, not just current status
ppt_tbl <- read_parquet(here::here("data/preprint_current.parquet")) |>
    filter(is_osp == 1) |>
    select(preprint_id, provider, created) 
ppt_events <- read_parquet(here::here("data/preprint_resources_ttlos.parquet")) |>
    inner_join(ppt_tbl, by = "preprint_id", relationship = "many-to-one")


#' Time to event summarizer
tte_summarizer <- function(tbl, t = time_to_event, x = event, ...) {
    # Totals
    df_n <- tbl |>
        summarize(
            .by = c(...),
            N = n_distinct(preprint_id)
        ) |>
        cross_join(distinct(tbl, {{ x }}))

    # Summary
    tbl |>
        summarise(
            .by = c({{ x }}, ...),
            n = sum(!is.na({{ t }})),
            mean = mean({{ t }}, na.rm = TRUE),
            p50 = median({{ t }}, na.rm = TRUE),
            sd = sd({{ t }}, na.rm = TRUE),
            min = min({{ t }}, na.rm = TRUE),
            max = max({{ t }}, na.rm = TRUE),
        ) |>
        left_join(df_n) |>
        mutate(
            p = n / N
        ) |>
        select(..., {{ x }}, n, p, mean, p50, sd, min, max)
}
```



Since preprints typically appear closer to the end of a research project, one might expect that the time to Lifecycle Open Science is shorter than in the case of OSF Registrations.

Unless otherwise stated, the starting sample for these analyses is all Open Science Preprints (OSP).  As of `r MOST_RECENT`, there are `r format(n_distinct(ppt_events$preprint_id), big.mark = ",")` Open Science Preprints (OSP) in the OSF.


```{r}
# Long form (among earliest connected resources of each type)
df_long <- ppt_events |>
    select(preprint_id, created, date_lifecycle, starts_with("date1_")) |>
    rename(date1_lifecycle = date_lifecycle) |>
    pivot_longer(
        cols = dplyr::matches("date1_"),
        names_to = "event",
        names_prefix = "date1_",
        values_to = "date"
    ) |>
    arrange(preprint_id, date)

#  Add sequencing
df_sequence <- df_long |>
    filter(event %in% c(tolower(PLANS), tolower(OUTPUTS)) & !is.na(date)) |>
    group_by(preprint_id) |>
    arrange(date) |>
    mutate(
        sequence = row_number()
    ) |>
    ungroup() |>
    select(preprint_id, event, sequence)

# Time-to-Event
df_tte <- df_long |>
    left_join(df_sequence) |>
    mutate(time_to_event = as.numeric(date - created, units = "days")) 
```


The following table summarizes how long it takes for an OSP to become fully lifecycle open.  Each row corresponds to three different milestones in the research project lifecycle:

1. The first linked plan resource
2. The first linked output resource
3. The achievement of lifecycle open status

The "Prevalance" columns report the number and percentage of OSPs that have reached each milestone, while the "Distribution" columns provide summary statistics characterizing the center, spread, and range of time to each milestone (in days).

```{r}
df_summary <- tte_summarizer(df_tte, t = time_to_event, x = event)
tte_table(df_summary)
```


The following interactive graphic provides the same information via a boxplot.

```{r}
p <- df_tte |>
    filter(event %in% c("plan", "output", "lifecycle")) |>
    mutate(
        event = stringr::str_to_title(event),
        event = factor(event, levels = c("Plan", "Output", "Lifecycle"))
    ) |>
    ggplot() +
    geom_boxplot_interactive(
        aes(
            x = event,
            y = time_to_event,
            fill = event,
            data_id = event,
            group = event,
            tooltip = after_stat({
                paste0(
                    "Event: ", stringr::str_to_title(.data$fill),
                    "\n",
                    "\nMax: ", comma(.data$max),
                    "\nQ3: ", comma(.data$upper),
                    "\nMedian: ", comma(round(.data$middle)),
                    "\nQ1: ", comma(.data$lower),
                    "\nMin: ", comma(round(.data$min))
                )
            }),
            outlier.tooltip = paste(
                "Days: ", comma(round(time_to_event)))
            )
        ) +
        guides(fill = "none") +
        scale_y_continuous(labels = label_comma()) +
        labs(
            y = "Days",
            x = "Event",
            title = "Time to Lifecycle Open Status (in days)",
        ) +
        theme_minimal()
g <- girafe(ggobj = p)
g
```
